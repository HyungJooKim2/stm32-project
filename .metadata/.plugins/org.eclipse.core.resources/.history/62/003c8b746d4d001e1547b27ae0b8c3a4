/*
 * app.c
 *
 *  Created on: Aug 10, 2023
 *      Author: iot00
 */


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <stdint.h>

#include "main.h"
#include "app.h"

extern ADC_HandleTypeDef hadc1;
extern DMA_HandleTypeDef hdma_adc1;
extern UART_HandleTypeDef huart3;

static volatile uint16_t adc_value[4];
static volatile uint16_t exti_value = 0;

void app(void)
{
	HAL_ADC_Start_DMA(&hadc1, (uint32_t *)adc_value, 4);

	for (;;) {
		HAL_Delay(100);
		printf("x = %d y = %d t = %d v = %d b = %d\r\n",
		       adc_value[0], adc_value[1], adc_value[2], adc_value[3],
		       exti_value);
	}
}

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
	exti_value = GPIO_Pin;
}


int __io_putchar(int ch)
{
  HAL_UART_Transmit(&huart3, (uint8_t *)&ch, 1, 0xffff);
  return ch;
}

